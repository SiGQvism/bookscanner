<!DOCTYPE html><html lang="ja"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Camera Check</title>
<style>
body{margin:0;background:#000;color:#fff;display:flex;flex-direction:column;align-items:center;font:16px/1.3 sans-serif}
video{margin:1rem auto;width:90%;max-width:480px;border:3px solid #ae84ff;border-radius:12px;object-fit:contain}
button{margin:1rem;padding:.6rem 1.2rem;font-size:1rem;border:none;border-radius:6px;background:#8b508d;color:#fff;cursor:pointer}
</style>
</head><body>
<h1>ğŸ“· ã‚«ãƒ¡ãƒ©ãƒ†ã‚¹ãƒˆ</h1>
<video id="cam" muted playsinline></video>
<button id="switch">ğŸ”„ ã‚«ãƒ¡ãƒ©åˆ‡æ›¿</button>
<p id="log">â³ åˆæœŸåŒ–ä¸­â€¦</p>

<script async src="https://docs.opencv.org/4.x/opencv.js"></script>
<script>
const video   = document.getElementById('cam');
const log     = document.getElementById('log');
const btn     = document.getElementById('switch');
let  devices  = [], index = 0, stream = null;

btn.onclick = start;

async function start(){
  /* 1ï¸âƒ£ æ—§ã‚¹ãƒˆãƒªãƒ¼ãƒ åœæ­¢ */
  if(stream) stream.getTracks().forEach(t=>t.stop());

  /* 2ï¸âƒ£ ãƒ‡ãƒã‚¤ã‚¹åˆ—æŒ™ï¼ˆæœ€åˆã ã‘å–å¾—ï¼‰*/
  if(!devices.length){
    devices = await navigator.mediaDevices.enumerateDevices();
    devices = devices.filter(d=>d.kind==='videoinput');
    if(!devices.length) return log.textContent='âŒ ã‚«ãƒ¡ãƒ©ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“';
  }

  /* 3ï¸âƒ£ æ¬¡ã®ã‚«ãƒ¡ãƒ©ã‚’è©¦ã™ */
  const devId = devices[index % devices.length].deviceId;
  index++;

  try{
    stream = await navigator.mediaDevices.getUserMedia({
      video:{deviceId:{exact:devId}},
      audio:false
    });
    video.srcObject = stream;
    await video.play();
    log.textContent='âœ… æ˜ åƒå–å¾—æˆåŠŸ â€“ deviceId:'+devId;
  }catch(e){
    console.error(e);
    log.textContent='âš ï¸ èµ·å‹•å¤±æ•—:'+e.name+' â€“ æ¬¡ã®ã‚«ãƒ¡ãƒ©ã‚’è©¦ã—ã¾ã™';
  }
}

/* åˆå›èµ·å‹• */
start();
</script>
</body></html>
